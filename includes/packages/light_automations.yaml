automation:

#Casa

  - alias: Luzes da casa - Suíte
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d000120af26
      to: 'on'
    condition:
      condition: state
      entity_id: light.todos_os_leds_suite
      state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.todos_os_leds_suite
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.todos_os_leds_suite" -%}
          {%- set timmer_input = "input_select.tempo_luz_suite" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d000120af26" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.todos_os_leds_suite
        state: 'on'
      - service: light.turn_off
        entity_id: light.todos_os_leds_suite

  - alias: Luzes da casa - Banheiro Suíte
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d00016c01fd
      to: 'on'
    condition:
      condition: state
      entity_id: light.tudo_banheiro_suite
      state: 'off'
    action:
      - service: light.turn_on
        data_template:
          entity_id: >
              {%- if is_state('input_boolean.boa_noite' , 'off') -%}
                light.tudo_banheiro_suite
              {%- else -%}
                light.suite_banheiro_espelho
              {%- endif %}
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.tudo_banheiro_suite" -%}
          {%- set timmer_input = "input_select.tempo_luz_banheiro_suite" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d00016c01fd" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - wait_template: "{%- if states.switch.chuveirosuite.state == 'off' and as_timestamp(now()) - as_timestamp(states.switch.chuveirosuite.last_updated) | int == states.input_select.tempo_luz_banheiro_suite.state | int and states.binary_sensor.motion_sensor_158d00016c01fd.attributes['No motion since'] | int == states.input_select.tempo_luz_banheiro_suite.state | int -%}true{%- else -%}false{%- endif %}"
      - condition: state
        entity_id: light.tudo_banheiro_suite
        state: 'on'
      - service: light.turn_off
        entity_id: light.tudo_banheiro_suite

  - alias: Luzes da casa - Banheiro Social
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d00016da83a
      to: 'on'
    condition:
      condition: state
      entity_id: light.tudo_banheiro_social
      state: 'off'
    action:
      - service: light.turn_on
        data_template:
          entity_id: >
              {%- if is_state('input_boolean.boa_noite' , 'off') -%}
                light.tudo_banheiro_social
              {%- else -%}
                light.banheiro_social_espelho
              {%- endif %}
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.tudo_banheiro_social" -%}
          {%- set timmer_input = "input_select.tempo_luz_banheiro_social" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d00016da83a" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - wait_template: "{%- if states.switch.chuveirosocial.state == 'off' and as_timestamp(now()) - as_timestamp(states.switch.chuveirosocial.last_updated) | int == states.input_select.tempo_luz_banheiro_social.state | int and states.binary_sensor.motion_sensor_158d00016da83a.attributes['No motion since'] | int == states.input_select.tempo_luz_banheiro_social.state | int -%}true{%- else -%}false{%- endif %}"
      - condition: state
        entity_id: light.tudo_banheiro_social
        state: 'on'
      - service: light.turn_off
        entity_id: light.tudo_banheiro_social

  - alias: Luzes da casa - Quarto
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d00015b6c81
      to: 'on'
    condition:
      condition: state
      entity_id: light.luzes_principais_quarto
      state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.luzes_principais_quarto
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.luzes_principais_quarto" -%}
          {%- set timmer_input = "input_select.tempo_luz_quarto" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d00015b6c81" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.luzes_principais_quarto
        state: 'on'
      - service: light.turn_off
        entity_id: light.luzes_principais_quarto

  - alias: Luzes da casa - Sala
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d0001225607
      to: 'on'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: light.luzes_principais_sala
          state: 'off'
        - condition: state
          entity_id: light.mesa_jantar
          state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.luzes_principais_sala
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.luzes_principais_sala" -%}
          {%- set timmer_input = "input_select.tempo_luz_sala" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d0001225607" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.luzes_principais_sala
        state: 'on'
      - service: light.turn_off
        entity_id: light.luzes_principais_sala

  - alias: Luzes da casa - Cozinha
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d0001231d4d
      to: 'on'
    condition:
      condition: state
      entity_id: light.luzes_principais_cozinha
      state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.luzes_principais_cozinha
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.luzes_principais_cozinha" -%}
          {%- set timmer_input = "input_select.tempo_luz_cozinha" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d0001231d4d" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.luzes_principais_cozinha
        state: 'on'
      - service: light.turn_off
        entity_id: light.luzes_principais_cozinha

# MuvRH

  - alias: MuvRH 203 - Luz da entrada
    initial_state: True
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d0001ad6b83
      to: 'on'
    condition:
      condition: state
      entity_id: light.muv203entrada
      state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.muv203entrada
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.muv203entrada" -%}
          {%- set timmer_input = "input_select.tempo_muvrh_203_entrada" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d0001ad6b83" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.muv203entrada
        state: 'on'
      - service: light.turn_off
        entity_id: light.muv203entrada

  - alias: MuvRH 203 - Luz do banheiro
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d0001e43ef1
      to: 'on'
    condition:
      condition: state
      entity_id: light.muv203banheiro
      state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.muv203banheiro
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.muv203banheiro" -%}
          {%- set timmer_input = "input_select.tempo_muvrh_203_banheiro" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d0001e43ef1" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.muv203banheiro
        state: 'on'
      - service: light.turn_off
        entity_id: light.muv203banheiro

  - alias: MuvRH 203 - Luz da sala de operações
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d0001e420d0
      to: 'on'
    condition:
      condition: state
      entity_id: light.muv203operacoes
      state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.muv203operacoes
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.muv203operacoes" -%}
          {%- set timmer_input = "input_select.tempo_muvrh_203_salaoperacoes" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d0001e420d0" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.muv203operacoes
        state: 'on'
      - service: light.turn_off
        entity_id: light.muv203operacoes

  - alias: MuvRH 203 - Luz da nossa sala
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d0001e02f9a
      to: 'on'
    condition:
      condition: state
      entity_id: light.muv203nossasala
      state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.muv203nossasala
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.muv203nossasala" -%}
          {%- set timmer_input = "input_select.tempo_muvrh_203_nossasala" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d0001e02f9a" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.muv203nossasala
        state: 'on'
      - service: light.turn_off
        entity_id: light.muv203nossasala

  - alias: MuvRH 303 - Luz da entrada
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d0001e44035
      to: 'on'
    condition:
      condition: state
      entity_id: light.muv303entrada
      state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.muv303entrada
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.muv303entrada" -%}
          {%- set timmer_input = "input_select.tempo_muvrh_303_entrada" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d0001e44035" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.muv303entrada
        state: 'on'
      - service: light.turn_off
        entity_id: light.muv303entrada

  - alias: MuvRH 303 - Luz da dinâmica
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d0001a24bdc
      from: 'off'
      to: 'on'
    condition:
      condition: state
      entity_id: light.muv303dinamica
      state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.muv303dinamica
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.muv303dinamica" -%}
          {%- set timmer_input = "input_select.tempo_muvrh_303_dinamica" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d0001a24bdc" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.muv303dinamica
        state: 'on'
      - service: light.turn_off
        entity_id: light.muv303dinamica

  - alias: MuvRH 303 - Luz do banheiro
    trigger:
      platform: state
      entity_id: binary_sensor.motion_sensor_158d0001ad6c20
      from: 'off'
      to: 'on'
    condition:
      condition: state
      entity_id: light.muv303banheiro
      state: 'off'
    action:
      - service: light.turn_on
        entity_id: light.muv303banheiro
      - delay: 00:00:05
      - wait_template: >
          {% set light = "light.muv303banheiro" -%}
          {%- set timmer_input = "input_select.tempo_muvrh_303_banheiro" -%}
          {%- set motion_sensor = "binary_sensor.motion_sensor_158d0001ad6c20" -%}

          {%- set motion = state_attr(motion_sensor, 'No motion since') | int -%}
          {%- set time = states(timmer_input) | int -%}
          {%- set light_state = states(light) -%}
          {%- set sensor_state = states(motion_sensor) -%}

          {%- if is_state(light , 'off') or (motion == time and sensor_state == 'off') -%}true{%- else -%}false{%- endif %}
      - condition: state
        entity_id: light.muv303banheiro
        state: 'on'
      - service: light.turn_off
        entity_id: light.muv303banheiro